{% extends "core/base.html" %}
{% block title %}{{ object.user.username }}{% endblock title %}
{% block content %}
    {% load field %}
    <style>
        .tg-card-header[data-toggle="collapse"] .fas {
            transition: transform 0.3s ease;
        }
        .tg-card-header[aria-expanded="false"] .fas {
            transform: rotate(-90deg);
        }
    </style>
    <div class="container py-4">
        <!-- Page Header -->
        <div class="tg-card header-card mb-4">
            <div class="tg-card-header">
                <h1 class="tg-card-title {{ object.preferred_heading }}">{{ object.user.username }}</h1>
                {% if user == object.user %}
                    <div class="tg-card-actions">
                        <a href="{% url 'profile_update' object.pk %}" class="tg-btn btn-primary btn-sm">
                            <i class="fas fa-edit"></i> Edit Profile
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Settings Card -->
        <div class="tg-card mb-4">
            <div class="tg-card-header" style="cursor: pointer;" data-toggle="collapse" data-target="#settings-section" aria-expanded="true">
                <h3 class="tg-card-title {{ object.preferred_heading }}">
                    <i class="fas fa-chevron-down"></i> Profile Settings
                </h3>
                {% if user == object.user %}
                    <div class="tg-card-actions">
                        <a href="{% url 'profile_update' object.pk %}" class="tg-btn btn-primary btn-sm" onclick="event.stopPropagation();">
                            <i class="fas fa-cog"></i> Edit Settings
                        </a>
                    </div>
                {% endif %}
            </div>
            <div id="settings-section" class="collapse show">
                <div class="tg-card-body">
                    {% include "accounts/includes/settings.html" %}
                </div>
            </div>
        </div>

        {% include "accounts/includes/active_scenes.html" %}
        
        {% if object.is_st %}
            {% include "accounts/includes/chronicles.html" %}
            {% include "accounts/includes/attention.html" %}
            {% include "accounts/includes/journals.html" %}
            {% include "accounts/includes/xp_spend_requests.html" %}
        {% endif %}
        
        {% include "accounts/includes/characters.html" %}
        {% include "accounts/includes/locations.html" %}
        {% include "accounts/includes/items.html" %}
        {% comment %} {% include "accounts/includes/xp_story.html" %} {% endcomment %}
        {% include "accounts/includes/xp_weekly.html" %}
        
        {% if object.is_st %}
            {% if user == object.user %}
                {% include "accounts/includes/xp_scene_st.html" %}
                {% comment %} {% include "accounts/includes/xp_story_st.html" %} {% endcomment %}
                {% include "accounts/includes/xp_weekly_st.html" %}
                {% include "accounts/includes/freebies.html" %}
                {% include "accounts/includes/character_approval.html" %}
                {% include "accounts/includes/location_approval.html" %}
                {% include "accounts/includes/item_approval.html" %}
                {% include "accounts/includes/rote_approval.html" %}
                {% include "accounts/includes/image_approval.html" %}
            {% endif %}
        {% endif %}
    </div>

    <script>
        // Handle chevron rotation on collapse toggle
        document.addEventListener('DOMContentLoaded', function() {
            const collapseHeaders = document.querySelectorAll('[data-toggle="collapse"]');
            
            collapseHeaders.forEach(function(header) {
                const target = document.querySelector(header.getAttribute('data-target'));
                
                if (target) {
                    target.addEventListener('show.bs.collapse', function() {
                        header.setAttribute('aria-expanded', 'true');
                    });
                    
                    target.addEventListener('hide.bs.collapse', function() {
                        header.setAttribute('aria-expanded', 'false');
                    });
                }
            });
        });
    </script>
{% endblock content %}
