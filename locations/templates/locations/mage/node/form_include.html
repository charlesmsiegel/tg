{% load formset_tags %}
<!-- Instructions Card -->
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Node Creation Guide</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        <p class="mb-2">Nodes are created as per <strong>Sources of Magick</strong> rules. A node has <strong>3 points per rank</strong>.</p>
        <p class="mb-2">
            Points are divided between Merits and Flaws (at cost), Size and Ratio (from -2 to 2),
            additional Resonance (1 each after {{ current_node.rating }} ranks of resonance) and
            total tass/quintessence generated. Additionally, choose the thematic form of the Quintessence and Tass.
        </p>
        <p class="mb-0">
            Nodes contain reality zones equal to their rank. Choose {{ current_node.rating }} positive levels
            of Practices and the same number of negative levels.
        </p>
    </div>
</div>

<!-- Basic Information -->
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Basic Information</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="{{ form.name.id_for_label }}" class="form-label">Name</label>
                {{ form.name }}
            </div>
            <div class="col-md-6">
                <label for="{{ form.contained_within.id_for_label }}" class="form-label">Contained Within</label>
                {{ form.contained_within }}
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-4">
                <label for="{{ form.rank.id_for_label }}" class="form-label">Rank</label>
                {{ form.rank }}
            </div>
            <div class="col-md-4">
                <label for="{{ form.size.id_for_label }}" class="form-label">Size</label>
                {{ form.size }}
            </div>
            <div class="col-md-4">
                <label for="{{ form.ratio.id_for_label }}" class="form-label">Ratio</label>
                {{ form.ratio }}
            </div>
        </div>
    </div>
</div>

<!-- Dimensional Barriers -->
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Dimensional Barriers</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        <div class="row mb-3">
            <div class="col-md-4">
                <label for="{{ form.gauntlet.id_for_label }}" class="form-label">Gauntlet</label>
                {{ form.gauntlet }}
            </div>
            <div class="col-md-4">
                <label for="{{ form.shroud.id_for_label }}" class="form-label">Shroud</label>
                {{ form.shroud }}
            </div>
            <div class="col-md-4">
                <label for="{{ form.dimension_barrier.id_for_label }}" class="form-label">Dimension Barrier</label>
                {{ form.dimension_barrier }}
            </div>
        </div>
    </div>
</div>

<!-- Energy Output -->
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Energy Output</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="{{ form.quintessence_form.id_for_label }}" class="form-label">Quintessence Form</label>
                {{ form.quintessence_form }}
            </div>
            <div class="col-md-6">
                <label for="{{ form.tass_form.id_for_label }}" class="form-label">Tass Form</label>
                {{ form.tass_form }}
            </div>
        </div>
    </div>
</div>

<!-- Merits and Flaws -->
{% if merits_and_flaws.count != 0 %}
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Merits and Flaws</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        {% formset form.merit_flaw_formset prefix="merit_flaw" add_label="Add Merit/Flaw" add_class="tg-btn btn-primary" wrapper_class="row mb-3 merit-flaw-row" %}
            <div class="col-md-6">
                <label class="form-label">Merit/Flaw</label>
                {{ subform.mf }}
            </div>
            <div class="col-md-4">
                <label class="form-label">Rating</label>
                {{ subform.rating }}
            </div>
        {% endformset %}
    </div>
</div>
{% endif %}

<!-- Resonance -->
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Resonance</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        {% formset form.resonance_formset prefix="resonance" add_label="Add Resonance" add_class="tg-btn btn-primary" wrapper_class="row mb-3 resonance-row" %}
            <div class="col-md-6">
                <label class="form-label">Resonance Type</label>
                {{ subform.resonance }}
            </div>
            <div class="col-md-4">
                <label class="form-label">Rating</label>
                {{ subform.rating }}
            </div>
        {% endformset %}
    </div>
</div>

<!-- Reality Zone -->
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Reality Zone</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        {% formset form.reality_zone_formset prefix="reality_zone" add_label="Add Reality Zone Rating" add_class="tg-btn btn-primary" wrapper_class="row mb-3 reality-zone-row" %}
            <div class="col-md-6">
                <label class="form-label">Practice</label>
                {{ subform.practice }}
            </div>
            <div class="col-md-4">
                <label class="form-label">Rating</label>
                {{ subform.rating }}
            </div>
        {% endformset %}
    </div>
</div>

<!-- Description -->
<div class="tg-card mb-4">
    <div class="tg-card-header">
        <h2 class="tg-card-title mta_heading">Description</h2>
    </div>
    <div class="tg-card-body" style="padding: 24px;">
        {{ form.description }}
    </div>
</div>
