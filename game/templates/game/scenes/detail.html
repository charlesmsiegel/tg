{% extends "core/base.html" %}
{% block title %}
    {{ chronicle.name }} Scenes
{% endblock title %}
{% block content %}
    <div class="container py-4">
        <!-- Chronicle Header -->
        <div class="tg-card header-card mb-4" data-gameline="{{ chronicle.gameline }}">
            <div class="tg-card-header text-center">
                <h1 class="tg-card-title {{ chronicle.headings }}">
                    <a href="{{ chronicle.get_absolute_url }}" class="text-decoration-none">{{ chronicle.name }}</a> Scenes
                </h1>
            </div>
        </div>
        <!-- Grouped Scenes by Date -->
        {% for date, scenes in scenes_grouped %}
            <div class="tg-card mb-4">
                <!-- Centered Month-Year Header -->
                <div class="tg-card-header text-center {{ chronicle.headings }} pointer"
                     data-toggle="collapse"
                     data-target="#date-{{ date.year }}-{{ date.month }}-Section"
                     aria-expanded="true"
                     aria-controls="date-{{ date.year }}-{{ date.month }}-Section">
                    <h4 class="tg-card-title mb-0">{{ date|date:"Y F" }}</h4>
                </div>
                <div id="date-{{ date.year }}-{{ date.month }}-Section" class="collapse show">
                    <div class="tg-card-body" style="padding: 0;">
                        {% if scenes %}
                            <div class="tg-table-responsive" style="padding: 20px;">
                                <table class="tg-table" style="margin: 0 auto; table-layout: fixed; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th style="padding: 16px; text-align: center; width: 25%;">Title</th>
                                            <th style="padding: 16px; text-align: center; width: 20%;">Location</th>
                                            <th style="padding: 16px; text-align: center; width: 15%;">Date of Scene</th>
                                            <th style="padding: 16px; text-align: center; width: 20%;">Last Post Character</th>
                                            <th style="padding: 16px; text-align: center; width: 20%;">Last Post Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for scene in scenes %}
                                            <tr>
                                                <td data-label="Title" style="padding: 16px; text-align: center; vertical-align: middle;">
                                                    <a href="{{ scene.get_absolute_url }}">{{ scene.name }}</a>
                                                    {% if not scene.finished %}
                                                        <br><span class="tg-badge badge-pill" style="background-color: rgba(255, 193, 7, 0.15); color: #d39e00; border-radius: 20px; margin-top: 4px;">Ongoing</span>
                                                    {% endif %}
                                                </td>
                                                <td data-label="Location" style="padding: 16px; text-align: center; vertical-align: middle;">
                                                    <a href="{{ scene.location.get_absolute_url }}">{{ scene.location }}</a>
                                                </td>
                                                <td data-label="Date of Scene" style="padding: 16px; text-align: center; vertical-align: middle;">{{ scene.date_of_scene|date:"F d, Y" }}</td>
                                                {% if not scene.finished %}
                                                    <td data-label="Last Post Character" style="padding: 16px; text-align: center; vertical-align: middle;">{{ scene.most_recent_post.display_name }}</td>
                                                    <td data-label="Last Post Date" style="padding: 16px; text-align: center; vertical-align: middle;">{{ scene.most_recent_post.datetime_created }}</td>
                                                {% else %}
                                                    <td data-label="Last Post Character" class="text-muted" style="padding: 16px; text-align: center; vertical-align: middle;">N/A</td>
                                                    <td data-label="Last Post Date" class="text-muted" style="padding: 16px; text-align: center; vertical-align: middle;">N/A</td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <p class="text-muted mb-0">No scenes for this month</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="tg-card">
                <div class="tg-card-body text-center" style="padding: 40px;">
                    <p class="text-muted mb-0">No scenes found</p>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock content %}
