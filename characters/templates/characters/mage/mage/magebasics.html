{% extends "core/form.html" %}
{% block creation_title %}
    Create Mage
{% endblock creation_title %}
{% block formdetails %}
    method="post"
    id="mageForm"
    data-factions-url="{% url 'characters:mage:ajax:load_factions' %}"
    data-subfactions-url="{% url 'characters:mage:ajax:load_subfactions' %}"
    action=""
    novalidate
    enctype="multipart/form-data"
{% endblock formdetails %}
{% block contents %}
    {% csrf_token %}
    <div class="row">
        <div class="col-sm">Decide identity and motivation; choose concept, Affiliation, Essence, and Archetypes.</div>
    </div>
    <div class="centertext container">
        <div class="row">
            <div class="col-sm"></div>
            <div class="col-sm">Character Portrait</div>
            <div class="col-sm">{{ form.image }}</div>
            <div class="col-sm"></div>
        </div>
        <div class="row">
            <div class="col-sm-2">Name</div>
            <div class="col-sm-2">{{ form.name }}</div>
            <div class="col-sm-2">Nature</div>
            <div class="col-sm-2">{{ form.nature }}</div>
            <div class="col-sm-2">Affiliation</div>
            <div class="col-sm-2">{{ form.affiliation }}</div>
        </div>
        <div class="row">
            <div class="col-sm-2">Chronicle</div>
            <div class="col-sm-2">{{ form.chronicle }}</div>
            <div class="col-sm-2">Demeanor</div>
            <div class="col-sm-2">{{ form.demeanor }}</div>
            <div class="col-sm-2">Faction</div>
            <div class="col-sm-2">{{ form.faction }}</div>
        </div>
        <div class="row">
            <div class="col-sm-2">Essence</div>
            <div class="col-sm-2">{{ form.essence }}</div>
            <div class="col-sm-2">Concept</div>
            <div class="col-sm-2">{{ form.concept }}</div>
            <div class="col-sm-2">Subfaction</div>
            <div class="col-sm-2">{{ form.subfaction }}</div>
        </div>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-2"></div>
            <div class="col-sm-2"></div>
            <div class="col-sm-2"></div>
            {% if storyteller %}
                <div class="col-sm-2">NPC</div>
                <div class="col-sm-2">{{ form.npc }}</div>
            {% else %}
                <div class="col-sm-2"></div>
                <div class="col-sm-2"></div>
            {% endif %}
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
$("#id_affiliation").change(function () {
    var url = $("#mageForm").attr("data-factions-url");
    var affiliationId = $(this).val();
    $.ajax({
        url: url,
        data: {
            'affiliation': affiliationId
        },
        success: function (data) {
            populateDropdown('#id_faction', data.options);
            populateDropdown('#id_subfaction', []);
        }
    });
});

$("#id_faction").change(function () {
    var factionId = $(this).val();
    $.ajax({
        url: '{% url 'characters:mage:ajax:load_subfactions' %}',
        data: {
            'faction': factionId
        },
        success: function (data) {
            populateDropdown('#id_subfaction', data.options);
        }
    });
});
    </script>
{% endblock contents %}
{% block buttons %}
    <input name="Save" type="submit" value="Save" />
{% endblock buttons %}
